name: Extract Changes

on:
  push:
    paths:
      - 'CPI_Artifacts_Metadata.txt'  # or specify specific file types you're interested in

jobs:
  extract:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        id: step0
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Important! Full history needed for proper diffs

      - name: Extract Changes
        id: step1
        run: |
          echo "🔍 Extracting added lines from modified files..."
          git diff HEAD^ HEAD > diff.txt
          echo "📄 Diff output saved to diff.txt"
          echo "📥 Extracting Added/Deleted/Changed lines..."
          grep '^+' diff.txt | grep -v '^+++' | sed 's/^+//' > added_lines.txt
          echo "✅ Added/Deleted/Changed lines extracted:"
          cat added_lines.txt
          {
          echo 'fileoutput<<EOF'
          cat added_lines.txt
          echo EOF
          } >> "$GITHUB_OUTPUT"

      - name: Call BTP CI IFlow
        run: |
          echo "${{steps.step1.outputs.fileoutput}}"
          curl -X GET https://accenture-sbg-asg.it-cpi024-rt.cfapps.eu10-002.hana.ondemand.com/http/SyncArtifactsDispatcher/GITHUB \
               -H "Content-Type: application/text" \
               -H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vYWNjZW50dXJlLXNiZy1hc2cuYXV0aGVudGljYXRpb24uZXUxMC5oYW5hLm9uZGVtYW5kLmNvbS90b2tlbl9rZXlzIiwia2lkIjoiZGVmYXVsdC1qd3Qta2V5LWQ0YWUwMzEyNjIiLCJ0eXAiOiJKV1QiLCJqaWQiOiAiUUJEc3phQjhibmRWbmJGVklsK0tCVmx3ZnVVa2NCTWVySTR1RlNqeGNGMD0ifQ.eyJqdGkiOiJmYWZhOWNiMmM1M2Q0MzU4ODg3MzZmZjk5MGI0MDc5OSIsImV4dF9hdHRyIjp7ImVuaGFuY2VyIjoiWFNVQUEiLCJzdWJhY2NvdW50aWQiOiJlMTI1ZGE3Ny0wM2I0LTRmODgtYWQ4Yy1kNTA1NWMyY2ZhZWEiLCJ6ZG4iOiJhY2NlbnR1cmUtc2JnLWFzZyIsInNlcnZpY2VpbnN0YW5jZWlkIjoiMTZkZDQ4NTMtNDliOC00NGY2LWI3YzEtYWQ5OTQzNDk3OTM4In0sInN1YiI6InNiLTE2ZGQ0ODUzLTQ5YjgtNDRmNi1iN2MxLWFkOTk0MzQ5NzkzOCFiMzY0NDEyfGl0IWIxODI3MjIiLCJhdXRob3JpdGllcyI6WyJpdCFiMTgyNzIyLk5vZGVNYW5hZ2VyLnJlYWQiLCJpdCFiMTgyNzIyLkNvbXBhbnlQcm9maWxlLldyaXRlIiwiaXQhYjE4MjcyMi5BbmFseXRpY3MuUmVhZCIsIml0IWIxODI3MjIuVHJhZGluZ1BhcnRuZXJQcm9maWxlLldyaXRlIiwiaXQhYjE4MjcyMi5XZWJUb29saW5nQ2F0YWxvZy5DcmVhdGUiLCJpdCFiMTgyNzIyLkNvbmZpZ3VyYXRpb25TZXJ2aWNlLlJ1bnRpbWVCdXNpbmVzc1BhcmFtZXRlcldyaXRlIiwiaXQhYjE4MjcyMi5XZWJUb29saW5nQ2F0YWxvZy5Eb3dubG9hZCIsIml0IWIxODI3MjIuSW50ZWdyYXRpb25DZWxsT3BlcmF0aW9uQ29ja3BpdC5SZWFkIiwiaXQhYjE4MjcyMi5Ob2RlTWFuYWdlci5yZWFkY3JlZGVudGlhbHMiLCJpdCFiMTgyNzIyLkV4dGVybmFsTG9nZ2luZ0FjdGl2YXRpb24uUmVhZCIsIml0IWIxODI3MjIuR2VuZXJhdGlvbkFuZEJ1aWxkLmdlbmVyYXRpb25hbmRidWlsZGNvbnRlbnQiLCJpdCFiMTgyNzIyLk5vZGVNYW5hZ2VyLlJlc3RhcnRDb21wb25lbnQiLCJpdCFiMTgyNzIyLk1lc3NhZ2VQcm9jZXNzaW5nTG9ja3MuUmVhZCIsIml0IWIxODI3MjIuQWNjZXNzUG9saWNpZXMuUmVhZCIsIml0IWIxODI3MjIuVHJhZGluZ1BhcnRuZXJBZ3JlZW1lbnQuV3JpdGUiLCJpdCFiMTgyNzIyLkFncmVlbWVudFRlbXBsYXRlLlJlYWQiLCJpdCFiMTgyNzIyLldlYlRvb2xpbmcuRFNPREludGVncmF0aW9uIiwiaXQhYjE4MjcyMi5JbnRlZ3JhdGlvbkNlbGxEaWFnbm9zdGljcy5SZWFkIiwiaXQhYjE4MjcyMi5BZ3JlZW1lbnRUZW1wbGF0ZS5Xcml0ZSIsIml0IWIxODI3MjIuRGF0YUFyY2hpdmluZy5SZWFkIiwiaXQhYjE4MjcyMi5Db2RlbGlzdC5SZWFkIiwiaXQhYjE4MjcyMi5XZWJUb29saW5nQ2F0YWxvZy5PdmVydmlld1JlYWQiLCJpdCFiMTgyNzIyLkludGVncmF0aW9uQ2VsbFJGQ0FkYXB0ZXJNb25pdG9yLlJlYWQiLCJpdCFiMTgyNzIyLkIyQkludGVyY2hhbmdlLlJlYWQiLCJpdCFiMTgyNzIyLlRlbmFudFBhcnRuZXJEaXJlY3RvcnkucmVhZCIsInVhYS5yZXNvdXJjZSIsIml0IWIxODI3MjIuQW5hbHl0aWNzLldyaXRlIiwiaXQhYjE4MjcyMi5Db21wYW55UHJvZmlsZS5SZWFkIiwiaXQhYjE4MjcyMi5JbnRlZ3JhdGlvbk9wZXJhdGlvblNlcnZlci5yZWFkIiwiaXQhYjE4MjcyMi5JbnRlZ3JhdGlvbkNlbGxDb21wb25lbnQuUmVhZCIsIml0IWIxODI3MjIuRVNCRGF0YVN0b3JlLnJlYWQiLCJpdCFiMTgyNzIyLlRyYWRpbmdQYXJ0bmVyUHJvZmlsZS5SZWFkIiwiaXQhYjE4MjcyMi5EZWZhdWx0IiwiaXQhYjE4MjcyMi5XZWJUb29saW5nLkludGVncmF0aW9uRmxvd0NvbmZpZ3VyZSIsIml0IWIxODI3MjIuV2ViVG9vbGluZ0NhdGFsb2cuRGV0YWlsc1JlYWQiLCJpdCFiMTgyNzIyLlRyYWRpbmdQYXJ0bmVyQWdyZWVtZW50LlJlYWQiLCJpdCFiMTgyNzIyLkludGVncmF0aW9uQ2VsbFJ1bnRpbWVQYXJhbWV0ZXIuUmVhZCIsIml0IWIxODI3MjIuRVNCRGF0YVN0b3JlLnJldHJ5IiwiaXQhYjE4MjcyMi5Ob2RlTWFuYWdlci5kZXBsb3ljb250ZW50IiwiaXQhYjE4MjcyMi5Ob2RlTWFuYWdlci5kZXBsb3ljcmVkZW50aWFscyIsIml0IWIxODI3MjIuUm9sZXMuV3JpdGUiLCJpdCFiMTgyNzIyLldvcmtzcGFjZUFydGlmYWN0TG9ja3MuUmVhZCIsIml0IWIxODI3MjIuV2ViVG9vbGluZ1dvcmtzcGFjZS5SZWFkIiwiaXQhYjE4MjcyMi5UcmFkaW5nUGFydG5lckFncmVlbWVudC5QdWJsaXNoIiwiaXQhYjE4MjcyMi5Sb2xlcy5SZWFkIiwiaXQhYjE4MjcyMi5XZWJUb29saW5nV29ya3NwYWNlLldyaXRlIl0sInNjb3BlIjpbIml0IWIxODI3MjIuTm9kZU1hbmFnZXIucmVhZCIsIml0IWIxODI3MjIuQ29tcGFueVByb2ZpbGUuV3JpdGUiLCJpdCFiMTgyNzIyLkFuYWx5dGljcy5SZWFkIiwiaXQhYjE4MjcyMi5UcmFkaW5nUGFydG5lclByb2ZpbGUuV3JpdGUiLCJpdCFiMTgyNzIyLldlYlRvb2xpbmdDYXRhbG9nLkNyZWF0ZSIsIml0IWIxODI3MjIuQ29uZmlndXJhdGlvblNlcnZpY2UuUnVudGltZUJ1c2luZXNzUGFyYW1ldGVyV3JpdGUiLCJpdCFiMTgyNzIyLldlYlRvb2xpbmdDYXRhbG9nLkRvd25sb2FkIiwiaXQhYjE4MjcyMi5JbnRlZ3JhdGlvbkNlbGxPcGVyYXRpb25Db2NrcGl0LlJlYWQiLCJpdCFiMTgyNzIyLk5vZGVNYW5hZ2VyLnJlYWRjcmVkZW50aWFscyIsIml0IWIxODI3MjIuRXh0ZXJuYWxMb2dnaW5nQWN0aXZhdGlvbi5SZWFkIiwiaXQhYjE4MjcyMi5HZW5lcmF0aW9uQW5kQnVpbGQuZ2VuZXJhdGlvbmFuZGJ1aWxkY29udGVudCIsIml0IWIxODI3MjIuTm9kZU1hbmFnZXIuUmVzdGFydENvbXBvbmVudCIsIml0IWIxODI3MjIuTWVzc2FnZVByb2Nlc3NpbmdMb2Nrcy5SZWFkIiwiaXQhYjE4MjcyMi5BY2Nlc3NQb2xpY2llcy5SZWFkIiwiaXQhYjE4MjcyMi5UcmFkaW5nUGFydG5lckFncmVlbWVudC5Xcml0ZSIsIml0IWIxODI3MjIuQWdyZWVtZW50VGVtcGxhdGUuUmVhZCIsIml0IWIxODI3MjIuV2ViVG9vbGluZy5EU09ESW50ZWdyYXRpb24iLCJpdCFiMTgyNzIyLkludGVncmF0aW9uQ2VsbERpYWdub3N0aWNzLlJlYWQiLCJpdCFiMTgyNzIyLkFncmVlbWVudFRlbXBsYXRlLldyaXRlIiwiaXQhYjE4MjcyMi5EYXRhQXJjaGl2aW5nLlJlYWQiLCJpdCFiMTgyNzIyLkNvZGVsaXN0LlJlYWQiLCJpdCFiMTgyNzIyLldlYlRvb2xpbmdDYXRhbG9nLk92ZXJ2aWV3UmVhZCIsIml0IWIxODI3MjIuSW50ZWdyYXRpb25DZWxsUkZDQWRhcHRlck1vbml0b3IuUmVhZCIsIml0IWIxODI3MjIuQjJCSW50ZXJjaGFuZ2UuUmVhZCIsIml0IWIxODI3MjIuVGVuYW50UGFydG5lckRpcmVjdG9yeS5yZWFkIiwidWFhLnJlc291cmNlIiwiaXQhYjE4MjcyMi5BbmFseXRpY3MuV3JpdGUiLCJpdCFiMTgyNzIyLkNvbXBhbnlQcm9maWxlLlJlYWQiLCJpdCFiMTgyNzIyLkludGVncmF0aW9uT3BlcmF0aW9uU2VydmVyLnJlYWQiLCJpdCFiMTgyNzIyLkludGVncmF0aW9uQ2VsbENvbXBvbmVudC5SZWFkIiwiaXQhYjE4MjcyMi5FU0JEYXRhU3RvcmUucmVhZCIsIml0IWIxODI3MjIuVHJhZGluZ1BhcnRuZXJQcm9maWxlLlJlYWQiLCJpdCFiMTgyNzIyLkRlZmF1bHQiLCJpdCFiMTgyNzIyLldlYlRvb2xpbmcuSW50ZWdyYXRpb25GbG93Q29uZmlndXJlIiwiaXQhYjE4MjcyMi5XZWJUb29saW5nQ2F0YWxvZy5EZXRhaWxzUmVhZCIsIml0IWIxODI3MjIuVHJhZGluZ1BhcnRuZXJBZ3JlZW1lbnQuUmVhZCIsIml0IWIxODI3MjIuSW50ZWdyYXRpb25DZWxsUnVudGltZVBhcmFtZXRlci5SZWFkIiwiaXQhYjE4MjcyMi5FU0JEYXRhU3RvcmUucmV0cnkiLCJpdCFiMTgyNzIyLk5vZGVNYW5hZ2VyLmRlcGxveWNvbnRlbnQiLCJpdCFiMTgyNzIyLk5vZGVNYW5hZ2VyLmRlcGxveWNyZWRlbnRpYWxzIiwiaXQhYjE4MjcyMi5Sb2xlcy5Xcml0ZSIsIml0IWIxODI3MjIuV29ya3NwYWNlQXJ0aWZhY3RMb2Nrcy5SZWFkIiwiaXQhYjE4MjcyMi5XZWJUb29saW5nV29ya3NwYWNlLlJlYWQiLCJpdCFiMTgyNzIyLlRyYWRpbmdQYXJ0bmVyQWdyZWVtZW50LlB1Ymxpc2giLCJpdCFiMTgyNzIyLlJvbGVzLlJlYWQiLCJpdCFiMTgyNzIyLldlYlRvb2xpbmdXb3Jrc3BhY2UuV3JpdGUiXSwiY2xpZW50X2lkIjoic2ItMTZkZDQ4NTMtNDliOC00NGY2LWI3YzEtYWQ5OTQzNDk3OTM4IWIzNjQ0MTJ8aXQhYjE4MjcyMiIsImNpZCI6InNiLTE2ZGQ0ODUzLTQ5YjgtNDRmNi1iN2MxLWFkOTk0MzQ5NzkzOCFiMzY0NDEyfGl0IWIxODI3MjIiLCJhenAiOiJzYi0xNmRkNDg1My00OWI4LTQ0ZjYtYjdjMS1hZDk5NDM0OTc5MzghYjM2NDQxMnxpdCFiMTgyNzIyIiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsInJldl9zaWciOiI3YzZiNGJiOSIsImlhdCI6MTc1MzM1NzYwMywiZXhwIjoxNzUzNDAwODAzLCJpc3MiOiJodHRwczovL2FjY2VudHVyZS1zYmctYXNnLmF1dGhlbnRpY2F0aW9uLmV1MTAuaGFuYS5vbmRlbWFuZC5jb20vb2F1dGgvdG9rZW4iLCJ6aWQiOiJlMTI1ZGE3Ny0wM2I0LTRmODgtYWQ4Yy1kNTA1NWMyY2ZhZWEiLCJhdWQiOlsiaXQhYjE4MjcyMi5UcmFkaW5nUGFydG5lclByb2ZpbGUiLCJpdCFiMTgyNzIyLkludGVncmF0aW9uQ2VsbFJ1bnRpbWVQYXJhbWV0ZXIiLCJpdCFiMTgyNzIyLldlYlRvb2xpbmdDYXRhbG9nIiwiaXQhYjE4MjcyMi5JbnRlZ3JhdGlvbkNlbGxEaWFnbm9zdGljcyIsIml0IWIxODI3MjIuRGF0YUFyY2hpdmluZyIsIml0IWIxODI3MjIuV2ViVG9vbGluZ1dvcmtzcGFjZSIsIml0IWIxODI3MjIuSW50ZWdyYXRpb25DZWxsUkZDQWRhcHRlck1vbml0b3IiLCJ1YWEiLCJpdCFiMTgyNzIyLkFuYWx5dGljcyIsIml0IWIxODI3MjIuTm9kZU1hbmFnZXIiLCJpdCFiMTgyNzIyLkNvZGVsaXN0IiwiaXQhYjE4MjcyMi5Sb2xlcyIsIml0IWIxODI3MjIuQjJCSW50ZXJjaGFuZ2UiLCJpdCFiMTgyNzIyLkV4dGVybmFsTG9nZ2luZ0FjdGl2YXRpb24iLCJpdCFiMTgyNzIyLlRyYWRpbmdQYXJ0bmVyQWdyZWVtZW50IiwiaXQhYjE4MjcyMi5HZW5lcmF0aW9uQW5kQnVpbGQiLCJpdCFiMTgyNzIyLkludGVncmF0aW9uQ2VsbE9wZXJhdGlvbkNvY2twaXQiLCJpdCFiMTgyNzIyLkVTQkRhdGFTdG9yZSIsIml0IWIxODI3MjIiLCJpdCFiMTgyNzIyLldlYlRvb2xpbmciLCJpdCFiMTgyNzIyLkludGVncmF0aW9uT3BlcmF0aW9uU2VydmVyIiwiaXQhYjE4MjcyMi5JbnRlZ3JhdGlvbkNlbGxDb21wb25lbnQiLCJpdCFiMTgyNzIyLldvcmtzcGFjZUFydGlmYWN0TG9ja3MiLCJpdCFiMTgyNzIyLlRlbmFudFBhcnRuZXJEaXJlY3RvcnkiLCJpdCFiMTgyNzIyLk1lc3NhZ2VQcm9jZXNzaW5nTG9ja3MiLCJzYi0xNmRkNDg1My00OWI4LTQ0ZjYtYjdjMS1hZDk5NDM0OTc5MzghYjM2NDQxMnxpdCFiMTgyNzIyIiwiaXQhYjE4MjcyMi5BY2Nlc3NQb2xpY2llcyIsIml0IWIxODI3MjIuQ29tcGFueVByb2ZpbGUiLCJpdCFiMTgyNzIyLkNvbmZpZ3VyYXRpb25TZXJ2aWNlIiwiaXQhYjE4MjcyMi5BZ3JlZW1lbnRUZW1wbGF0ZSJdfQ.euiufKrI3ifYKWkbVA2O63fwUZhK34Azwk_Ozt2MYJatZVR04s3KaYIQ9H1eC_TINHSnORCkdBGqvSYQmjNpf0KrXUO8HFhKP1Vi59B0H4I3k_Fy-A1VblmVYUEO3kYzTDQK1rpSO3ILLoM6gvJfJKuI06L3SnsO9ew8txF_73unueNRYcegehphW_dDFh-3oQa8ea7LS1IjVAWy3HjfT1l1qCStNctDq56gth_N4d9f3huTJpWfiwbf3DvmIqz-fQTX0mNyONUJi57kMVrcrxkCJyeOfHA5NAqLdTuMg5pGXLgfzYnSYCaiz-Mhv5epaT_1BmB9kguLH1XD-ICsxw" \
               -d '${{steps.step1.outputs.fileoutput}}'
