name: Extract Changes

on:
  push:
    paths:
      - '**.txt'  # or specify specific file types you're interested in

jobs:
  extract:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        id: step0
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Important! Full history needed for proper diffs

      - name: Extract Changes
        id: step1
        run: |
          echo "ðŸ” Extracting added lines from modified files..."
          git diff HEAD^ HEAD > diff.txt
          echo "ðŸ“„ Diff output saved to diff.txt"
          echo "ðŸ“¥ Extracting Added/Deleted/Changed lines..."
          grep '^+' diff.txt | grep -v '^+++' | sed 's/^+//' > added_lines.txt
          echo "âœ… Added/Deleted/Changed lines extracted:"
          {
          echo 'fileoutput<<EOF'
          cat added_lines.txt
          echo EOF
          } >> "$GITHUB_OUTPUT"

      - name: Call BTP CI IFlow
        run: |
          curl -X GET https://589d90eftrial.it-cpitrial06-rt.cfapps.us10-001.hana.ondemand.com/http/SyncArtifacts/GITHUB \
               -H "Content-Type: application/text" \
               -H "Authorization: Bearer ${{ secrets.API_KEY }}" \
               -d ${{steps.step1.outputs.fileoutput}}
